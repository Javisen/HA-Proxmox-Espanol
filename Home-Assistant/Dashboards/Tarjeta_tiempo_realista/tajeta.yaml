type: custom:stack-in-card
card_mod:
  style: |
    ha-card {
      --primary-text-color: #ffffff;
      --secondary-text-color: #ffffff;
    {% if states('sun.sun') == "below_horizon" %}
      background: linear-gradient( rgba(13, 55, 113, 0.3), rgba(15, 33, 70, 0.4) ), url('/local/clima/noche3.png');
      background-position: center;
      background-size: cover;          
    {% else %}
      {% set condition = states('sensor.aemet_condition') %}
      {% if condition =="clear-night"%}
      background: linear-gradient( rgba(13, 55, 113, 0.4), rgba(15, 33, 70, 0.4) ), url('/local/clima/amanecer.png');
      background-position: center;
      background-size: cover; 
      {% elif condition =="exceptional" or condition =="sunny" or condition =="windy"
      or condition =="partlycloudy" %}
      background: linear-gradient(rgba(29,156,199,0.6), rgba(29,156,199,0.2)), url('/local/clima/soleado3.png');
      background-position: center;
      background-size: cover;        
      {% elif condition =="hail" or condition =="snowy" or condition =="snowy-rainy"
      %} background: #ffffff!important;
      {% elif condition =="lightning" or condition =="lightning-rainy" or condition =="pouring" or condition
      =="rainy" %}
      background: linear-gradient(rgba(88,111,119,0.5), rgba(88,111,119,0.5)), url('/local/clima/lloviendo2.png');
      background-position: center;
      background-size: cover;          
      {% else %}
      background: linear-gradient(rgba(121,146,155,0.2), rgba(121,146,155,0.2)), url('/local/clima/nublado.png');
      background-position: center;
      background-size: cover;          
      {% endif %}
    {% endif %} }
cards:
  - type: custom:mushroom-template-card
    primary: |
      {% set condition = states('sensor.aemet_condition') %}
      {% if condition =="clear-night"%}
      Noche clara
      {% elif condition =="cloudy"%}
      Nublado
      {% elif condition =="sunny"%}
      Soleado
      {% elif condition =="lightning-rainy"%}
      Lluvioso
      {% endif %}
    layout: vertical
    icon: >-
      {% set condition = states('sensor.aemet_condition') %} {% if condition
      =="clear-night" %}
       mdi:weather-night 
      {% elif condition =="exceptional" %}
       mdi:weather-sunny 
      {% elif condition =="partlycloudy" %}
       mdi:weather-partly-cloudy 
      {% else %} 
       mdi:weather-{{ condition }}
      {% endif %}
    tap_action:
      action: navigate
      navigation_path: meteo
    icon_color: >-
      {% if states('sun.sun') == "below_horizon" %}
       #ffffff
      {% else %}

      {% set condition = states('sensor.aemet_condition') %}

      {% if condition =="clear-night" or condition =="lightning" or
      condition=="lightning-rainy" %}
       #ffffff
      {% elif condition =="exceptional" or condition =="sunny" or condition
      =="partlycloudy" %}
       #000000
      {% elif condition =="windy" %}
       #ffffff
      {% elif condition =="hail" or condition =="snowy" or condition
      =="snowy-rainy" %}
       #2b2b2b
      {% elif condition =="lightning" or condition =="snowy" or condition
      =="snowy-rainy" %}
       #2b2b2b
      {% elif condition =="pouring" or condition =="rainy" %}
       #ffffff 
      {% else %}
       #ffffff
      {% endif %} 
    card_mod:
      style: |
        ha-card {
          border: 0px;
          --icon-symbol-size: 30px;
        }
  - type: custom:mushroom-chips-card
    alignment: center
    card_mod:
      style: |
        ha-card {
          margin-top: -17px;
          --chip-spacing: 0px !important;
          --chip-padding: 5px !important;
        }
    chips:
      - type: template
        tap_action:
          action: navigate
          navigation_path: meteo
        icon: mdi:thermometer
        content: "{{ states('sensor.gandia_temperature') |int}}ÂºC"
        card_mod:
          style: |
            ha-card {
              border: 0px;
              background: transparent!important;
              box-shadow: none!important;
              height: 33px!important;
              --chip-icon-size: 25px;
              font-size: 45px !important;
              font-color: blue !important;
            }
      - type: template
        tap_action:
          action: navigate
          navigation_path: meteo
        icon: mdi:umbrella
        content: "{{ states('sensor.aemet_rain_probability') }}%"
        card_mod:
          style: |
            ha-card {
              border: 0px;
              background: transparent!important;
              box-shadow: none!important;
              height: 33px!important;
              --chip-icon-size: 25px;
              font-size: 45px !important;
            }
      - type: template
        tap_action:
          action: navigate
          navigation_path: meteo
        icon: |-
          {% if is_state('binary_sensor.sensor_de_lluvia_water_leak', 'on') %}
            mdi:weather-pouring
          {% else %}
            mdi:weather-sunny
          {% endif %}
        content: |-
          {% if is_state('binary_sensor.sensor_de_lluvia_water_leak', 'on') %}
           Llueve
          {% else %}
           Seco
          {% endif %}
        card_mod:
          style: |
            ha-card {
              border: 0px;
              background: transparent!important;
              box-shadow: none!important;
              height: 33px!important;
              --chip-icon-size: 29px;
              font-size: 45px !important;
            }
  - type: custom:mushroom-template-card
    primary: ""
    secondary: ""
    icon: |
      {% if states('sun.sun') == "below_horizon" %}
      phu:scene-nightlight
      {% elif states('sun.sun') == "above_horizon" %}
      mdi:white-balance-sunny
      {% endif %}    
    tap_action:
      action: navigate
      navigation_path: meteo
    icon_color: |
      {% if states('sun.sun') == "below_horizon" %}
       amber
      {% elif states('sun.sun') == "above_horizon" %}
       yellow
      {% endif %}    
    card_mod:
      style: |
        ha-card {
          border: 0px;
          margin-top: -185px;
          margin-bottom: -20px;
          margin-left: -180px;
          --icon-size: 134px;
          opacity: 0.5;
          background: transparent !important;
        }
        {% if states('sun.sun') == "below_horizon" %}
        ha-state-icon {
          animation: beat 3.3s ease-out infinite both;
          transform-origin: 70% 60%;
        }
        @keyframes beat {
          0% { transform: scale(1); }
          10% { transform: scale(1.05); }
          17% { transform: scale(1); }
          33% { transform: scale(1.05); }
          60% { transform: scale(1); }
        }
        {% elif states('sun.sun') == "above_horizon" %}
        ha-state-icon {
          animation: spin 20s linear infinite;
        }
        {% endif %}    
        mushroom-shape-icon {
          --shape-color: none !important;
          --icon-color: amber !important;
        }
